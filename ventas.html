<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Tech - Ventas</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/landingPage.css">
    <link rel="icon" type="image/png" href="assets/logo.jpg">
</head>

<body data-page="ventas">

    <div id="sidebar-placeholder"></div>
    <div id="topbar-placeholder"></div>

    <main id="main-content" class="p-4">
        <div class="container-fluid">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Ventas</h3>
                <div>
                    <button id="btnOpenNewSale" class="btn btn-primary me-2">
                        <i class="bi bi-plus-lg"></i> Nueva venta
                    </button>
                    <button id="btnRefreshSales" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-clockwise"></i> Refrescar
                    </button>
                </div>
            </div>

            <!-- En caso de que no haya sucursal en el perfil -->
            <div id="sucursal-warning" class="alert alert-warning d-none">
                No se encontró una sucursal en tu perfil. Ingresa el ID de sucursal para ver ventas:
                <div class="input-group mt-2" style="max-width:360px;">
                    <input id="inputSucursalId" class="form-control" type="number" placeholder="ID sucursal">
                    <button id="btnSaveSucursal" class="btn btn-outline-primary">Guardar</button>
                </div>
            </div>

            <div class="card rounded-15">
                <div class="card-body">
                    <div class="table-responsive">
                         <table id="ventasTable" class="table table-striped table-hover align-middle text-center">
                             <thead>
                                  <tr>
                                      <th>ID</th>
                                      <th>Fecha</th>
                                      <th>Cliente</th>
                                      <th>Producto</th>
                                      <th>Cantidad</th>
                                      <th>Total</th>
                                      <th>Método de Pago</th>
                                      <th>Estado</th>
                                      <th>Acciones</th>
                                  </tr>
                             </thead>
                            <tbody>
                                <!-- filas inyectadas por JS -->
                            </tbody>
                        </table>
                    </div>
                    <div id="ventas-empty" class="text-muted small text-center py-3 d-none">
                        No hay ventas para esta sucursal.
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="footer-placeholder"></div>

     <!-- Modal: Ver detalles de venta -->
     <div class="modal fade" id="modalViewSale" tabindex="-1" aria-hidden="true">
         <div class="modal-dialog modal-lg modal-dialog-centered">
             <div class="modal-content">
                 <div class="modal-header">
                     <h5 class="modal-title">Detalles de Venta</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                 </div>
                 <div class="modal-body" id="viewSaleContent">
                     <!-- Detalles se inyectan aquí -->
                 </div>
             </div>
         </div>
     </div>

     <!-- Modal: Registrar/Modificar venta -->
     <div class="modal fade" id="modalNewSale" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <form id="formNewSale" autocomplete="off">
                    <div class="modal-header">
                        <h5 class="modal-title">Registrar nueva venta</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                     <div class="modal-body">
                         <div class="row g-3">
                              <div class="col-12 col-md-4">
                                   <label class="form-label">Seleccionar Cliente</label>
                                   <input type="text" id="inputCliente" class="form-control" placeholder="Buscar cliente...">
                                   <input type="hidden" id="idCliente">
                                   <div id="clienteSuggestions" class="autocomplete-dropdown" style="display: none;"></div>
                               </div>
                               <div class="col-12 col-md-4">
                                   <label class="form-label">Seleccionar Producto</label>
                                   <input type="text" id="inputProducto" class="form-control" placeholder="Buscar producto...">
                                   <input type="hidden" id="idProducto">
                                   <div id="productoSuggestions" class="autocomplete-dropdown" style="display: none;"></div>
                               </div>

                             <div class="col-12 col-md-3">
                                 <label class="form-label">Cantidad</label>
                                 <input name="cantidad" id="inputCantidad" class="form-control" type="number" min="1"
                                     value="1" required>
                             </div>
                              <div class="col-12 col-md-3">
                                  <label class="form-label">Precio unitario</label>
                                  <input name="precioUnitario" id="inputPrecioUnitario" class="form-control" type="number"
                                      min="0" step="0.01" required readonly>
                              </div>
                              <div class="col-12 col-md-3">
                                  <label class="form-label">Descuento (%)</label>
                                  <input name="descuento" id="inputDescuento" class="form-control" type="number"
                                      min="0" step="0.01" value="0" placeholder="Ej: 10">
                              </div>
                              <div class="col-12 col-md-3">
                                  <label class="form-label">Impuesto (%)</label>
                                  <input name="impuesto" id="inputImpuesto" class="form-control" type="number"
                                      min="0" step="0.01" value="0" placeholder="Ej: 15">
                              </div>

                              <div class="col-12 col-md-4">
                                  <label class="form-label">Total</label>
                                  <input name="total" id="inputTotal" class="form-control" type="number" step="0.01"
                                      readonly>
                              </div>

                              <div class="col-12 col-md-4">
                                  <label class="form-label">Método de Pago</label>
                                  <select name="metodoPago" id="inputMetodoPago" class="form-select">
                                      <option value="">Seleccione método de pago</option>
                                      <option value="EFECTIVO">Efectivo</option>
                                      <option value="TARJETA">Tarjeta</option>
                                      <option value="TRANSFERENCIA">Transferencia</option>
                                      <option value="CHEQUE">Cheque</option>
                                  </select>
                              </div>

                             <div class="col-12">
                                 <label class="form-label">Notas (opcional)</label>
                                 <textarea name="notas" id="inputNotas" class="form-control" rows="2"></textarea>
                             </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button id="btnSubmitSale" type="submit" class="btn btn-primary">Registrar venta</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="js/partials.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/session.js"></script>
    <script type="module" src="js/ventas.js"></script>
</body>

</html>